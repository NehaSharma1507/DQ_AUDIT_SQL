 
INSERT INTO ADW_DEV.ADW_DQ_AUDIT.DATA_QUALITY_LOG (
   target_table_primary_key_val
  ,target_object
  ,target_attribute_name
  ,source_object
  ,exception_target_load_ts
  ,exception_severity_level
  ,dq_rule_id
  ,dq_log_ts
  ,dq_log_id
  ,dq_exception_val 
  ,business_ts
  ,business_domain
)
SELECT 
   'STORE_CD|TILL_NUM|TRAN_DT|TRAN_TM|TRAN_NUM|PROMOTION_OFFER_CD'
  ,'ADW_PL.FACT_SALES_TRANS_DISCOUNT_HDR'
  ,'N/A'
  ,'ADW_PL.FACT_SALES_TRANS_DISCOUNT_LINE'
  ,tran_dt
  ,3
  ,2
  ,TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP())
  ,adw_dev.adw_dq_audit.data_quality_log_id.nextval
  ,STORE_CD||'|'||TILL_NUM||'|'||TRAN_DT||'|'||TRAN_TM||'|'||TRAN_NUM||'|'||PROMOTION_OFFER_CD
  ,tran_dt
  ,'SALES'   
FROM 
   ADW_PROD.ADW_PL.FACT_SALES_TRANS_DISCOUNT_LINE
WHERE
  (STORE_CD,TILL_NUM,TRAN_DT,TRAN_TM,TRAN_NUM,PROMOTION_OFFER_CD) IN
  (

 Select STORE_CD,TILL_NUM,B.TRAN_DT,B.TRAN_TM,B.TRAN_NUM,PROMOTION_OFFER_CD
 from "ADW_PROD"."ADW_PL"."FACT_SALES_TRANS_DISCOUNT_LINE" as B , "ADW_PROD"."ADW_RDV"."SALES_TRANS_DISCOUNT_HDR_LINK" as A
 where A.STORE_NK1=B.STORE_CD
 and A.TILL_NK1=B.TILL_NUM
 and A.TRAN_DT=B.TRAN_DT
 and A.TRAN_TM=B.TRAN_TM
 and A.TRAN_NUM=B.TRAN_NUM
 and A.PROMOTION_OFFER_NK1=B.PROMOTION_OFFER_CD
 and B.TRAN_DT>current_date()-30
 group by STORE_CD,TILL_NUM,B.TRAN_DT,B.TRAN_TM,B.TRAN_NUM,PROMOTION_OFFER_CD
 minus
 Select STORE_CD,TILL_NUM,TRAN_DT,TRAN_TM,TRAN_NUM,PROMOTION_OFFER_CD
 from  "ADW_PROD"."ADW_PL"."FACT_SALES_TRANS_DISCOUNT_HDR"
 where TRAN_DT>current_date()-30
 group by STORE_CD,TILL_NUM,TRAN_DT,TRAN_TM,TRAN_NUM,PROMOTION_OFFER_CD)
